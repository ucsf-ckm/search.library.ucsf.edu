---
layout: default
---

  <div data-alert id="didyoumean" class="row hide">
  </div>
  <div class="row results-row">
    <div class="large-4 columns">
      <div class="panel radius">
        <span id="all-millennium" class="hide">
          <a href="#" target="_blank" class="round label right results-button">All Results</a>
        </span>
        <svg class="left" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">
          <path fill="#2571A1" d="M31.3 11.743L16.005 3.856C13.908 2.753 9.777 4.884 8.59 6.76c-.528.842-.49 1.447-.49 1.79l.19 17.808c.01.378.488.886.895 1.14.85.52 13.703 8.54 14.064 8.77.194.122.43.178.655.178.194 0 .39-.043.566-.13.39-.19.63-.558.63-.96V16.65c0-.39-.227-.748-.598-.943L10.6 7.946c.156-.306.774-.952 1.912-1.547 1.2-.63 2.094-.39 2.3-.312 0 0 13.345 7.142 13.753 7.354.406.212.415.245.415.607v17.747c0 .886.897 1.247 1.56 1.247.656 0 1.36-.646 1.36-1.247v-19.11c0-.39-.23-.75-.6-.944z"/>
        </svg>
        <p><strong>Library Catalog</strong></p>
        <div class="results-list" id="millennium">
        </div>
      </div>
    </div>
    
    <div class="large-4 columns">
      <div class="panel radius">
        <span id="all-sfx" class="hide">
          <a href="#" target="_blank" class="round label right results-button">All Results</a>
        </span>
        <span id="advanced-sfx" class="hide">
          <a href="http://ucelinks.cdlib.org:8888/sfx_ucsf/az?param_perform_value=locate" target="_blank" class="round label right results-button">Advanced Search</a>
        </span>
        <svg class="left" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">
          <path fill="#2571A1" d="M30.2 4.7H9.8c-1.87 0-3.4 1.53-3.4 3.4v23.8c0 1.87 1.53 3.4 3.4 3.4h20.4c1.872 0 3.4-1.53 3.4-3.4V8.1c0-1.87-1.528-3.4-3.4-3.4zm0 27.2H9.8V8.1h20.4v23.8zm-8.5-8.5h-8.5v1.7h8.5v-1.7zm5.1-6.8H20v1.7h6.8v-1.7zM20 14.9h6.8v-3.4H20v3.4zm-1.7-3.4h-5.1v6.8h5.1v-6.8zM16.6 20h-3.4v1.7h3.4V20zm1.7 1.7h8.5V20h-8.5v1.7zm8.5 5.1H13.2v1.7h13.6v-1.7zm-3.4-1.7h3.4v-1.7h-3.4v1.7z"/>
        </svg>
        <p><strong>Online Journals list</strong></p>
        <div class="results-list" id="sfx">
        </div>
      </div>
    </div>

    <div class="large-4 columns">
      <div class="panel radius">
        <span id="all-dbs" class="hide">
          <a href="#" target="_blank" class="round label right results-button">All Results</a>
        </span>
        <span id="advanced-dbs" class="hide">
          <a href="http://www.library.ucsf.edu/db" target="_blank" class="round label right results-button">Advanced Search</a>
        </span>
        <svg class="left" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">
          <path fill="#2571A1" d="M35.977 15.604l-12.656-3.39-2.214-8.265c-.186-.69-.925-1.094-1.653-.9L4.025 7.185c-.727.194-1.166.913-.983 1.603l5.49 20.488c.185.69.924 1.094 1.65.897l6.142-1.646-.838 3.125c-.185.692.253 1.41.98 1.605l13.788 3.694c.728.192 1.467-.208 1.65-.9l5.053-18.845c.186-.688-.252-1.407-.98-1.6zm-30.2-6.43l13.31-3.562 4.928 18.39-13.31 3.563-4.927-18.39zm23.877 25.217L18.07 31.224l.91-3.406 6.63-1.776c.73-.194 1.17-.91.983-1.603L24.03 14.87l10.108 2.774-4.484 16.747z"/>
        </svg><p><strong>Database list</strong></p>
        <div class="results-list" id="dbs">
        </div>
      </div>
    </div>
  </div>

  <div class="row results-row">
    <div class="large-4 columns">
      <div class="panel radius">
        <span id="all-pubmed" class="hide">
          <a href="#" target="_blank" class="round label right results-button">All Results</a>
        </span>
        <svg class="left" xmlns="http://www.w3.org/2000/svg" width="40.5" height="41.167" viewBox="0 0 40.5 41.167">
          <path fill="#231F1F" d="M2.712 3.182v24.336s9.355-1.09 9.355 8.05V12.536c.002-8.702-9.355-9.354-9.355-9.354"/><path fill="#aaa" d="M7.095 1.472v21.413s5.166.997 5.166 10.134c0 9.138.026-17.002.026-21.897 0-8.702-5.19-9.65-5.19-9.65"/><path fill="#3978AD" d="M12.427 12.318v22.146s4.49-12.582 23.374 3.627c0-5.873.038-20.688.038-25.584-18.665-13.597-23.41-.188-23.41-.188"/><path fill="#fff" d="M14.207 28.896h4.184l1.353-9.314h.043l3.714 9.314h1.674l3.884-9.314h.043l1.18 9.314h4.21L32.04 12.72h-4.184l-3.477 8.644-3.285-8.644h-4.14z"/>
        </svg>
        <p><strong>PubMed@UCSF</strong></p>
        <div class="results-list" id="pubmed">
        </div>       			
      </div>
    </div>

    <div class="large-4 columns">
      <div class="panel radius">
        <span id="all-libguides" class="hide">
          <a href="#" target="_blank" class="round label right results-button">All Results</a>
        </span>
        <svg class="left" xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">
          <path fill="#2571A1" d="M23.2 13.517c-.224-.604 6.02-6.18 2.378-10.696-.854-1.055-3.742 5.06-7.846 7.828-2.263 1.526-7.533 4.776-7.533 6.574v11.63c0 2.16 8.353 4.448 14.702 4.448 2.328 0 5.697-14.577 5.697-16.895 0-2.323-7.174-2.283-7.4-2.888zm-14.7.16c-1.117 0-5.1.68-5.1 5.31v8.24c0 4.627 3.983 5.136 5.1 5.136 1.117 0-1.7-.973-1.7-3.84V17.688c0-3.005 2.817-4.01 1.7-4.01z"/>
        </svg>
        <p><strong>Librarian Picks by Topic</strong></p>
        <div class="results-list" id="libguides">
        </div>       			
      </div>
    </div>

    <div class="large-4 columns">
      <div class="panel radius">
        <svg class="left" xmlns="http://www.w3.org/2000/svg" width="40" height="40.025" viewBox="-592.25 416.512 40 40.025" enable-background="new -592.25 416.512 40 40.025">
          <path fill="#2571A1" d="M-570.79 441.843v-18.7c.878-1.64 1.64-2.11 2.52-2.694v18.405c-1.23.878-2.346 2.285-2.52 2.988zm1.523.996c-.176-.176-.47-.294-.644-.41.292-.586 1.054-1.875 2.343-2.638l.353-.178v-16.12c.645-.937 2.05-1.288 2.755-1.347v18.172c-2.404.35-4.104 1.816-4.807 2.52zm1.64 2.87c-.058-1.287-.644-1.873-.702-1.992.53-.586 1.817-1.76 4.22-1.992l.588-.06V425.02c.527-.117 1.17-.293 2.403.41v8.97h1.29v-9.673s-2.052-1.524-3.693-.997v-2.93l-.705.06c-.116 0-1.758.174-3.106 1.288v-3.518l-.94.527c-.115.06-2.167 1.174-3.398 3.518v20.635c1.29.058 2.754 1.113 2.872 2.46h1.172l.002-.06z"/><g fill="#2571A1"><path d="M-588.436 444.13h1.642v1.64h-1.642zM-572.96 447.822h1.642v1.643h-1.642zM-584.566 447.822h1.642v1.643h-1.642zM-588.436 447.822h1.642v1.643h-1.642zM-576.83 447.822h1.643v1.643h-1.643zM-580.698 447.822h1.642v1.643h-1.642zM-561.237 447.822h1.642v1.643h-1.642zM-568.974 447.822h1.642v1.643h-1.642zM-565.106 447.822h1.643v1.643h-1.643zM-565.106 444.188h1.643v1.64h-1.643zM-588.436 440.378h1.642v1.64h-1.642zM-557.426 444.13h1.642v1.64h-1.642zM-557.426 447.822h1.642v1.643h-1.642zM-572.96 451.632h1.642v1.643h-1.642zM-584.566 451.632h1.642v1.643h-1.642zM-588.436 451.632h1.642v1.643h-1.642zM-576.83 451.632h1.643v1.643h-1.643zM-580.698 451.632h1.642v1.643h-1.642zM-561.237 451.632h1.642v1.643h-1.642zM-568.974 451.632h1.642v1.643h-1.642zM-565.106 451.632h1.643v1.643h-1.643zM-557.426 436.57h1.642v1.638h-1.642zM-557.426 440.378h1.642v1.64h-1.642zM-557.426 432.64h1.642v1.642h-1.642zM-561.295 436.57h1.642v1.638h-1.642zM-561.295 444.13h1.642v1.64h-1.642zM-561.237 440.378h1.642v1.64h-1.642z"/></g><path fill="#2571A1" d="M-576.066 445.594h-8.5V424.9c1.465-.76 2.52-.585 3.047-.35v18.172l.705.058c2.696.176 4.397 1.523 5.1 2.23-.118.116-.235.35-.35.584zm1.347-1.757c-.878-.82-2.93-2.345-5.627-2.696v-20.164c1.758.234 3.224 1.992 3.224 1.992v17.293l.47.235c1.407.82 2.286 2.17 2.696 2.873-.234.117-.528.293-.762.47zm1.994-1.173c-.35-.705-1.934-2.403-3.4-3.342v-20.81c.938.763 2.93 3.225 3.4 4.924v19.228z"/>
        </svg>
        <p><strong>News &amp; Services</strong></p>
        <div class="results-list" id="drupal6">
        </div>
      </div>
    </div>
  </div>

  <!-- if IE8 or less, give up and redirect to legacy QuickSearch -->
  <!--[if lt IE 9]>
    <script>
      window.location = 'http://www.library.ucsf.edu/quicksearch/' + encodeURIComponent(decodeURIComponent(window.location.hash.substring(1)));
    </script>
  <![endif]-->

  <script src="js/vendor/jquery.js"></script>
  <script src="js/foundation.min.js"></script>
  
  <!-- If IE9 or less, fix their broken XHR/CORS implementation -->
  <!--[if IE]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-ajaxtransport-xdomainrequest/1.0.2/jquery.xdomainrequest.min.js"></script>
  <![endif]-->
  <script>
    $(document).foundation();
  </script>

  <script>
  $(document).ready(function () {
    var showSuggestedTerms = function (suggestedTerms) {
      if (suggestedTerms && ('"' + suggestedTerms + '"' !== document.querySelector('.search-terms').value)) {
        var termsLink = $('<a>')
          .attr('href', '#' + suggestedTerms);
        termsLink.append(
          $('<em>')
            .text(suggestedTerms)
        );

        var didyoumean = $('#didyoumean').show();
        var alertBox = $('<div>')
          .addClass('alert-box')
          .addClass('info');
        var span = $('<span>')
          .append('Did you mean ')
          .append(termsLink)
          .append('?');
        alertBox.append(span);
        didyoumean.append(alertBox);
      }
    };

    var success = function (results) {
      var urlRegExp = /^(https?:)?\/\/[\w:\/\?&%=\.\-~\+]+$/;
      var elem = $('#' + results.name);
      if (elem.length) {
        elem.empty();
        var ol = $('<ol>');
        var li;
        var a;
        var text;

        var all = $('#all-' + results.name);
        var advanced = $('#advanced-' + results.name)

        var l = results.data.length;
        if (l) {
          for (var i=0; i<l; i++) {
            if (typeof results.data[i].url === "string" && results.data[i].url.match(urlRegExp)) {
              // Our Drupal 6 instance returns &amp; a lot. Until we upgrade or fix it somehow, this...
              if (results.name === "drupal6" && typeof results.data[i].name === "string") {
                results.data[i].name = results.data[i].name.replace(/&amp;/g, '&');
              }
              li = $('<li>');
              a = $('<a>')
                .attr('href', results.data[i].url)
                .attr('target', '_blank')
                .text(results.data[i].name);
              li.append(a);
              ol.append(li);
            } else {
              if (window.console && window.console.log) {
                window.console.log('Bad URL: ' + results.data[i].url);
              }
            } 
          }
          if (results.name !== "drupal6" && typeof results.url === "string" && results.url.match(urlRegExp)) {
            all.children('a').attr('href', results.url).show();
            all.show();
          } else {
            all.hide();
          }
          elem.append(ol);
        } else {
          elem.text('No results found.');
          all.hide();
          advanced.children('a').show();
          advanced.show();
        }
      }

      if (results.name === "pubmed" && results.suggestedTerms instanceof Array) {
        showSuggestedTerms(results.suggestedTerms[0]); 
      }
    }
    
    var failure = function (error) {
      if (console && error.message) {
        console.log(error.message);
      }
    };
    
    var runSearch = function (event) {
      $('.results-button').hide();
      $('#didyoumean').empty().hide();
      $('.results-list').each(function (index, elem) {
        elem.innerHTML = '<progress>Loading&hellip;</progress>';
      });
      var terms = this.querySelector('.search-terms').value;
      window.location.hash = encodeURIComponent(terms);
      if (typeof EventSource !== "undefined") {
        // asynchronous updates, woo hoo!
        UCSF.Library.search({q: terms.toLowerCase(), async: true}, success, failure);
      } else {
        // no server-sent events, so six separate AJAX calls, boo!
        var cols = ['dbs', 'sfx', 'millennium', 'pubmed', 'libguides', 'drupal6'];
        for (var i=0, l=cols.length; i<l; i++) {
          $.getJSON( 'http://apis.ucsf.edu/library/search', {q: terms, c:[cols[i]]}, function (col) {
            success(col[0]);
          })
            .fail(failure);
        }
      }
    };

    $('.search-form').each(function (index, elem) {
      elem.onsubmit = function (event) {
        event.preventDefault ? event.preventDefault() : event.returnValue = false;
        var terms = this.querySelector('.search-terms').value;
        window.location.hash = encodeURIComponent(terms);
      }
    });

    var runSearchWithHashValue = function () {
      document.querySelector('.search-terms').value = decodeURIComponent(window.location.hash.substring(1));
      runSearch.call(document, document);
    }

    if (window.location.hash) {
      $('title').text('UCSF Library Search: ' + decodeURIComponent(window.location.hash.substring(1)));
      runSearchWithHashValue()
    }

    var hashChangeHandler = function () {
      $('title').text('UCSF Library Search: ' + decodeURIComponent(window.location.hash.substring(1)));
      ga('send', 'pageview');
      runSearchWithHashValue();
    };

    $(window).bind('hashchange', hashChangeHandler);
  });
  </script>
